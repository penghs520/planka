# 条件过滤组件测试说明

## 当前完成状态

### ✅ 已完成的功能

1. **完整的类型定义** (`src/types/condition.ts`)
   - 支持 10 种条件类型：TEXT, NUMBER, DATE, ENUM, STATUS, STATE, TITLE, KEYWORD, CODE, WEB_URL
   - 完整的递归条件组结构（ConditionGroup）
   - 与后端 Java 类型完全对应

2. **核心组件架构**
   - `ConditionEditor.vue` - 根组件，提供上下文和 v-model 绑定
   - `ConditionGroupEditor.vue` - **支持完整递归嵌套**的条件组编辑器
   - `ConditionItemEditor.vue` - 条件项容器组件
   - `PathFieldSelector.vue` - 多级路径字段选择器（支持关联字段穿透）

3. **集成到视图配置**
   - 已成功集成到 `ViewEditForm.vue` 的"过滤条件"Tab
   - 支持从卡片类型自动加载字段列表
   - 双向绑定到 `formData.condition`

## 测试步骤

### 1. 启动开发服务器

开发服务器已启动在：**http://localhost:3001/**

```bash
cd planka-ui
npm run dev
```

### 2. 登录系统

1. 访问 http://localhost:3001/
2. 使用测试账号登录
3. 选择组织

### 3. 测试过滤组件

#### 步骤 1：进入视图管理页面
1. 在左侧菜单点击"视图管理"
2. 点击"新建视图"或编辑现有视图

#### 步骤 2：创建视图（如果是新建）
1. 输入视图名称（如"测试视图"）
2. 选择关联的卡片类型
3. 点击"创建"按钮

#### 步骤 3：切换到过滤条件Tab
1. 在视图编辑抽屉中，点击"过滤条件"Tab
2. 应该看到条件编辑器组件

#### 步骤 4：测试基础功能

**4.1 添加条件项**
- 点击"添加条件"按钮
- 应该出现一个新的条件项卡片
- 包含：字段选择器 + 操作符选择 + 值输入框 + 删除按钮

**4.2 选择字段**
- 点击"选择字段"下拉框
- 应该显示该卡片类型的所有可用字段
- 选择一个字段

**4.3 选择操作符**
- 点击"操作符"下拉框
- 应该根据字段类型显示对应的操作符列表
- 例如：文本字段显示"等于"、"包含"、"以...开始"等

**4.4 输入值**
- 在值输入框中输入测试值
- 如果选择"为空"或"不为空"操作符，值输入框应显示"无需输入值"

**4.5 删除条件项**
- 点击条件项右侧的删除按钮
- 条件项应被移除

#### 步骤 5：测试递归嵌套

**5.1 添加条件组**
- 点击顶层的"添加条件组"按钮
- 应该出现一个新的嵌套条件组
- 包含：AND/OR 选择器 + 操作按钮

**5.2 切换逻辑运算符**
- 点击"且 (AND)" / "或 (OR)"下拉框
- 切换逻辑运算符
- 验证切换成功

**5.3 在嵌套组中添加条件**
- 在嵌套的条件组中点击"添加条件"
- 应该在该组内添加条件项
- 观察视觉层级（左侧缩进 + 背景色）

**5.4 多层嵌套测试**
- 在嵌套组中再次点击"添加条件组"
- 测试 3-4 层深度的嵌套
- 验证每层都有正确的缩进和背景色

**5.5 删除条件组**
- 点击嵌套条件组的"删除组"按钮
- 整个条件组及其子节点应被移除

#### 步骤 6：测试数据保存

**6.1 构建复杂条件**
创建一个类似这样的条件结构：
```
AND
├─ 状态 = 进行中
├─ OR
│  ├─ 负责人 = 张三
│  └─ 创建人 = 张三
└─ 优先级 包含 P0
```

**6.2 保存视图**
- 点击抽屉底部的"保存"按钮
- 检查浏览器控制台，确认保存的数据结构正确

**6.3 重新打开**
- 关闭视图编辑抽屉
- 重新打开该视图进行编辑
- 切换到"过滤条件"Tab
- 验证之前配置的条件是否正确加载和显示

## 当前已知问题和限制

### ⚠️ 第一版限制

1. **条件类型支持**
   - ✅ 支持 TEXT（文本）条件
   - ❌ 其他 9 种条件类型的专用编辑器尚未实现
   - 当前所有类型都使用文本输入框（简化版）

2. **值输入控件**
   - 当前统一使用 `a-input` 文本框
   - 数字类型应使用 `a-input-number`
   - 日期类型应使用 `a-date-picker`
   - 枚举类型应使用 `a-select`
   - 这些将在阶段3实现

3. **路径选择（多级属性）**
   - Path 选择器尚未实现
   - 无法选择关联卡片的属性（如"父需求.创建人"）

4. **值引用功能**
   - ReferenceSource 功能未实现
   - 仅支持静态值输入

5. **表单验证**
   - 缺少字段必填验证
   - 缺少值格式验证

## 预期的浏览器输出

### 正常情况
- 开发服务器运行在 http://localhost:3001/
- 无编译错误
- 无运行时错误
- 条件编辑器可正常显示和交互

### 控制台输出
```javascript
// 点击"添加条件"时
Field changed: <fieldId>

// 切换操作符时
Operator changed: <operatorType>
```

## 数据结构示例

### 保存的 Condition 数据结构
```json
{
  "root": {
    "nodeType": "GROUP",
    "operator": "AND",
    "children": [
      {
        "nodeType": "TEXT",
        "subject": {
          "fieldId": "field_001"
        },
        "operator": {
          "type": "CONTAINS",
          "value": "测试"
        }
      },
      {
        "nodeType": "GROUP",
        "operator": "OR",
        "children": [
          {
            "nodeType": "TEXT",
            "subject": {
              "fieldId": "field_002"
            },
            "operator": {
              "type": "EQ",
              "value": "张三"
            }
          }
        ]
      }
    ]
  }
}
```

## 下一步计划

### 阶段 3：实现各类型条件项（2-3天）
1. TEXT/STATE/WEB_URL 专用编辑器
2. NUMBER/DATE 专用编辑器（带数字和日期控件）
3. ENUM/STATUS 专用编辑器（带下拉选择）

### 阶段 4：路径选择器（2天）
- 实现 PathSelector 组件
- 支持多级关联路径选择

### 阶段 5：工具函数和验证（1天）
- 表单验证
- 工具函数库
- 默认值工厂

## 问题反馈

如果遇到问题，请检查：
1. 浏览器控制台错误信息
2. Network 面板的 API 请求状态
3. Vue DevTools 组件状态

记录以下信息有助于排查：
- 浏览器版本
- 具体操作步骤
- 错误截图
- 控制台错误信息
